@{
    Layout = "~/Views/Shared/_Form.cshtml";
}
<link rel="stylesheet" href="~/Scripts/ComboSelect/css/comboselect.css" type="text/css">
<div class="content">
    <form id="form" class="layui-form">
        @Html.AntiForgeryToken()
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">相互关系</label>
                <div class="layui-input-inline">
                    <input type="hidden" name="CIPId" id="CIPId" />
                    <select name="RelationId" id="RelationId" lay-verify="required"></select>
                    <input type="checkbox" lay-skin="primary" name="IsReverse" value="true" title="反向">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">配置项</label>
                <div class="layui-input-inline">
                    <input type="hidden" name="Id" />
                    <div class="layui-input-inline">
                        <input lay-ignore type="text" name="CINId" id="CINId" placeholder="请输入配置项" autocomplete="off" class="layui-input width600">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="display: none">
            <div class="layui-input-block">
                <button id="btnSubmit" class="layui-btn" lay-submit lay-filter="add">提交</button>
            </div>
        </div>
    </form>
</div>
@section scripts {
    <script type="text/javascript" src="~/Scripts/ComboSelect/js/comboselect.min.js"></script>
    <script type="text/javascript" src="~/Scripts/ComboSelect/js/b.comboselect.js"></script>
    <script>
        var form = layui.form, layer = layui.layer;

        var primaryKey = $.getQueryString("primaryKey");

        $("#RelationId").bindSelect({
            url: "/Configure/Relations/GetListTreeSelect"
        });

        $.ajax({
            type: "post",
            url: "/Configure/CI/GetListCombo",
            success: function (data) {
                $('#CINId').bComboSelect({
                    showField: 'name',
                    keyField: 'id',
                    formatItem: function (data) {
                        return data.desc + '(' + data.name + ')';
                    },
                    data: eval('(' + data + ')')
                });
            }
        });
        form.render();

        form.on('submit(add)', function (data) {
            data.field.CIPId = primaryKey;
            $.formSubmit({
                url: "/Configure/Relations/SaveRelation",
                data: data.field
            });
            return false;
        });

    </script>
}
